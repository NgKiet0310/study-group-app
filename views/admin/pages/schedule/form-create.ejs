<% layout('layouts/main-admin') %>

<div class="container mt-5">
  <h2 class="mb-4 fw-bold text-primary">
    <i class="bi bi-calendar-plus me-2"></i> Tạo lịch học
  </h2>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger"><%= error %></div>
  <% } %>

  <form action="/admin/schedules/create" method="POST" class="shadow p-4 rounded bg-light border">
    <div class="mb-3">
      <label for="title" class="form-label fw-semibold">Tiêu đề</label>
      <input type="text" class="form-control" id="title" name="title"
        value="<%= formData.title || '' %>" placeholder="Nhập tiêu đề" required>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label fw-semibold">Mô tả</label>
      <textarea class="form-control" id="description" name="description" rows="3"
        placeholder="Thêm mô tả (tuỳ chọn)"><%= formData.description || '' %></textarea>
    </div>

    <div class="mb-3">
      <label for="room" class="form-label fw-semibold">Phòng</label>
      <select class="form-select" id="room" name="room" required>
        <option value="" disabled <%= !formData.room ? 'selected' : '' %>>-- Chọn phòng học --</option>
        <% rooms.forEach(room => { %>
          <option value="<%= room._id %>" <%= formData.room === room._id ? 'selected' : '' %>>
            <%= room.name %>
          </option>
        <% }) %>
      </select>
    </div>

    <div class="mb-3">
      <label for="participants" class="form-label fw-semibold">Người tham gia</label>
      <select class="form-select" id="participants" name="participants" multiple required>
        <% users.forEach(user => { %>
          <option value="<%= user._id %>" <%= (formData.participants || []).includes(user._id) ? 'selected' : '' %>>
            <%= user.username %>
          </option>
        <% }) %>
      </select>
      <div class="form-text">Giữ Ctrl (Windows) hoặc Command (Mac) để chọn nhiều người.</div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="startTime" class="form-label fw-semibold">Thời gian bắt đầu</label>
        <input type="datetime-local" class="form-control" id="startTime" name="startTime"
          value="<%= formData.startTime || '' %>" required>
      </div>
      <div class="col-md-6 mb-3">
        <label for="endTime" class="form-label fw-semibold">Thời gian kết thúc</label>
        <input type="datetime-local" class="form-control" id="endTime" name="endTime"
          value="<%= formData.endTime || '' %>" required>
      </div>
    </div>

    <% if (admin) { %>
      <input type="hidden" name="createdBy" value="<%= admin._id %>">
    <% } %>

    <div class="d-flex justify-content-between align-items-center">
      <button type="submit" class="btn btn-success px-4">
        <i class="bi bi-check-circle me-1"></i> Tạo lịch
      </button>
      <a href="/admin/schedules" class="btn btn-secondary">Quay lại</a>
    </div>
  </form>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function (e) {
    const room = document.querySelector('#room').value;
    const participants = document.querySelector('#participants').selectedOptions;
    if (!room || participants.length === 0) {
      e.preventDefault();
      alert("Vui lòng chọn đầy đủ phòng và người tham gia.");
    }
  });
</script>
