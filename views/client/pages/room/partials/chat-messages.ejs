<% if (messages.length > 0) { %>
  <% messages.forEach(msg => { %>
    <div class="chat-message d-flex <%= (user && user._id.toString() === msg.sender._id.toString()) ? 'own' : '' %>">
      
      <!-- Avatar -->
      <div class="user-avatar
        <%= (user && user._id.toString() === msg.sender._id.toString())
              ? 'bg-warning'
              : 'bg-secondary' %>">
        <%= msg.sender.username ? msg.sender.username[0].toUpperCase() : '?' %>
      </div>

      <!-- Bubble -->
      <div class="message-bubble">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <strong><%= msg.sender.username || "Ng∆∞·ªùi d√πng" %></strong>
          <small class="text-muted"><%= msg.createdAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) %></small>
        </div>
        <div><%= msg.content %></div>
      </div>
    </div>
  <% }) %>
<% } else { %>
  <p class="text-muted">üí¨ Ch∆∞a c√≥ tin nh·∫Øn n√†o trong ph√≤ng n√†y</p>
<% } %>
